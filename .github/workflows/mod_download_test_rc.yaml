name: ğŸ§ª Test All Server-Relevant Mods for Fabric from mods.txt RC

on:
  push:
    paths:
      - mods.txt
  workflow_dispatch:
    inputs:
      minecraft_version:
        description: 'Minecraft-Version fÃ¼r den Mod-Download'
        required: true
        default: '1.21.5'

jobs:
  test-mod-download:
    runs-on: ubuntu-latest

    steps:
      # ğŸ“‚ Repository auschecken
      - name: ğŸ“‚ Checkout repository
        uses: actions/checkout@v3

      # ğŸ“„ Mods aus mods.txt herunterladen und testen (nur fÃ¼r Fabric und server-relevante Mods)
      - name: â¬‡ï¸ Test Server-Relevant Mod Downloads for Fabric from mods.txt
        run: |
          mkdir -p test-mods
          echo "Testing downloads for all server-relevant Fabric mods in mods.txt with Minecraft version ${{ github.event.inputs.minecraft_version }}..."
          while IFS= read -r slug; do
            if [ ! -z "$slug" ]; then
              echo "Testing download for mod: $slug"
              curl -s "https://api.modrinth.com/v2/project/$slug/version" | jq -r '.[] | select(.game_versions[] | contains("${{ github.event.inputs.minecraft_version }}")) | select(.loaders[] | contains("fabric")) | select(.categories[] | contains("server")) | .files[0].url' | xargs -n 1 curl -O -J -o test-mods/$slug.jar
              if [ -f "test-mods/$slug.jar" ]; then
                echo "âœ… Mod $slug downloaded successfully!"
              else
                echo "âŒ Failed to download mod $slug."
                exit 1
              fi
            fi
          done < mods.txt